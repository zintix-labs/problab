🌐 语言：中文 | [En](README.md)

---

# Problab

<sub>由 <b>Zintix Labs</b> 维护 — <a href="https://github.com/nextso">@nextso</a></sub>

**Problab** 是一个面向数学设计师和工程师的高性能老虎机数学引擎。

一次构建，随后即可使用**相同的单一事实源**  
进行**模拟、复现及生产环境部署**。

**模拟执行路径与生产环境完全一致。**

---

## 什么是 Problab？

**如果在模拟中能运行，**  
**它在生产环境中也能以相同方式运行。**

Problab 是一个**老虎机数学执行引擎**，  
同时适用于大规模模拟和真实生产环境。

它是**同一个引擎**，可用于：

- 大规模数学模拟
- 基于种子的确定性复现
- 后端游戏服务器执行
- 开发与调试

不存在**“模拟逻辑”与“生产逻辑”的分离**。

---

## 为什么选择 Problab？

传统老虎机数学引擎通常存在以下问题：

- 模拟器速度快但**不适合生产环境**
- 生产引擎正确但**模拟速度过慢**
- 模拟逻辑与服务器逻辑**随时间发生偏离**
- 真实生产问题难以复现或无法复现

Problab 致力于解决上述核心难题。

---

## 核心设计目标

- **单一事实源**  
  一个引擎，一套逻辑路径，一致结果。

- **天生高性能**  
  零分配的关键路径，缓存友好的数据布局。

- **显式依赖注入**  
  无隐藏全局，无魔法初始化副作用。

- **开发者友好**  
  新增游戏只需提供：
  - 一个配置文件
  - 一个逻辑文件

- **模拟与生产执行路径一致**  
  模拟非伪造或重写，  
  运行与生产环境完全相同的确定性逻辑路径。

---

## 性能快照（MacBook Air M3）

以下数据均为**真实测量值**，非合成基准。

### 单核性能

| 游戏类型 | 吞吐量 |
|----------|------------|
| 简单（5x3，15条线） | 约 700 万转/秒 |
| 级联 / 聚集 | 约 170 万转/秒 |

### 四核并行执行

| 游戏类型 | 吞吐量 |
|----------|------------|
| 简单 | 约 1900 万转/秒 |
| 级联 / 聚集 | 约 580 万转/秒 |

### 实际运行示例输出

```bash
make run w=4 r=25000000
```

```text
[WORKERS:4] [GAME:demo_normal] [PLAYMODE:0] [SPINS:100,000,000]
used: 5.26 seconds                                                                                                                      
sps : 19,010,181 spins/sec
+--------------------------------+
|          demo_normal           |
+--------------+-----------------+
| Game Name    | demo_normal     |
| Game ID      | 0               |
| Total Rounds | 100,000,000     |
| Total RTP    | 95.56 %         |
| RTP 95% CI   | [95.42%,95.69%] |
| Total Bet    | 4,000,000,000   |
| Total Win    | 3,822,201,660   |
| Base Win     | 2,439,779,100   |
| Free Win     | 1,382,422,560   |
| NoWin Rounds | 71,034,259      |
| Trigger      | 835,933         |
| STD          | 6.797           |
| CV           | 7.113           |
+--------------+-----------------+

```

> 以上数据基于真实游戏逻辑  
> （线型中奖、免费游戏、级联、重力、倍数等）

---

## 典型使用场景

- 老虎机数学模拟与验证
- RTP / 波动率分析
- 确定性重放与调试
- 后端游戏服务器执行
- 数学变更的持续集成回归测试

---

## 内置数学报告（统计与验证）

Problab 提供一流的**数学验证报告**，用于校验与回归。

开箱即用，支持生成：

- **RTP 及 95% 置信区间**
- **标准差(STD) / 变异系数(CV)（波动率）**
- **命中率 / 未中奖率 / 触发率**
- **中奖分布区间**（基础 / 免费游戏 / 总计）
- **录制器风格汇总**，支持审计和调试流程

设计理念是实用的数学工作流程：  
**验证 → 比较 → 回归 → 解释**，且输入可复现。

Problab 将**验证输出**视为一等产品特性，而非附属功能。

**示例输出**

```
总RTP: 95.56%
RTP 95%置信区间: [95.42%, 95.69%]
标准差(STD): 6.797
变异系数(CV): 7.113
...
```

---

## 快速开始

**1分钟成功执行，3分钟生产环境就绪！**

本仓库专注于引擎本身，实际项目请从 scaffold 开始

使用 **problab-scaffold** — 基于 Problab 的干净起步模板。

👉 https://github.com/zintix-labs/problab-scaffold

模板提供：
- 预配置的配置 / 逻辑 / 服务器 / 模拟
- 一条命令启动（`make run`、`make dev`、`make svr`）
- 适合私有商业开发的项目结构

这是使用 Problab 构建真实游戏的**推荐方式**。

---

## 确定性与可复现性

- 基于种子的执行
- 可重放的结果
- 模拟与服务器行为一致

这使得 Problab 适用于：

- 数学审计
- 回归测试
- 生产问题调查

---

## 状态

- API 可能会在v1.0.0之前演进
- 重点在正确性、性能和核心架构

文档、测试和起步模板将逐步完善。

---

## 路线图

- Jackpot 支持（配置 + 快照/增量 delta）
- 更多可复用的 ops 操作
- （RFC）用于状态转换的 Trigger methods

---

## 贡献

对于 v0.x.y，我们**仅接受**：

- Bug 报告（尽可能附带最小复现或日志）
- 文档改进（修正、示例、翻译）

功能需求欢迎讨论，但可能暂不优先处理。

---

## 许可证

Apache License 2.0  
详见 [LICENSE](LICENSE) 和 [NOTICE](NOTICE)。
